<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>Jiaobei Divination Experience</title>

<style>
  :root{
    --gold: rgba(246, 210, 122, 0.95);
    --gold2: rgba(217, 169, 75, 0.95);
    --ink: rgba(255,255,255,0.92);
    --muted: rgba(255,255,255,0.72);
    --shadow: 0 18px 55px rgba(0,0,0,0.55);
  }

  html,body{
    height:100%;
    margin:0;
    overflow:hidden;
    font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", system-ui, sans-serif;
    color: var(--ink);
    background:#000;
  }

  /* Full background */
  .bg{
    position:fixed; inset:0;
    background:url("backgorund.jpg") center/cover no-repeat;
    transform: scale(1.03);
    filter: saturate(1.05) contrast(1.03);
  }
  /* Dark glass overlay */
  .shade{
    position:fixed; inset:0;
    background:
      radial-gradient(900px 520px at 50% 35%, rgba(0,0,0,0.18), rgba(0,0,0,0.58)),
      linear-gradient(180deg, rgba(0,0,0,0.35), rgba(0,0,0,0.55));
    backdrop-filter: blur(3px);
  }

  /* Floating dust / smoke */
  .mist{
    position:fixed; inset:-10%;
    pointer-events:none;
    opacity:0.55;
    background:
      radial-gradient(220px 160px at 20% 20%, rgba(255,220,150,.10), transparent 65%),
      radial-gradient(280px 180px at 80% 30%, rgba(255,240,210,.10), transparent 65%),
      radial-gradient(240px 180px at 40% 80%, rgba(200,220,255,.08), transparent 70%),
      radial-gradient(220px 160px at 70% 85%, rgba(255,220,150,.08), transparent 70%);
    animation: mistDrift 14s ease-in-out infinite;
    filter: blur(10px);
  }
  @keyframes mistDrift{
    0%{ transform: translate3d(-1%, -1%, 0) scale(1); }
    50%{ transform: translate3d(1.5%, 1.2%, 0) scale(1.02); }
    100%{ transform: translate3d(-1%, -1%, 0) scale(1); }
  }

  /* Main container */
  .wrap{
    position:relative;
    height:100%;
    display:flex;
    align-items:center;
    justify-content:center;
    padding: env(safe-area-inset-top) 18px env(safe-area-inset-bottom) 18px;
  }

  .stage{
    width:min(520px, 92vw);
    text-align:center;
    transform: translateY(6px);
    animation: enter 900ms cubic-bezier(.2,.9,.2,1) both;
  }
  @keyframes enter{
    from{ opacity:0; transform: translateY(24px) scale(.98); }
    to{ opacity:1; transform: translateY(6px) scale(1); }
  }

  .title{
    font-size: 22px;
    letter-spacing: .18em;
    margin: 0 0 6px;
    text-shadow: 0 10px 35px rgba(0,0,0,.5);
  }
  .subtitle{
    margin:0 0 28px;
    font-size: 13px;
    color: var(--muted);
    letter-spacing: .08em;
  }

  /* Rune ring */
  .rune{
    position:absolute;
    left:50%;
    top: 43%;
    transform: translate(-50%,-50%);
    width:min(340px, 86vw);
    aspect-ratio:1/1;
    border-radius:999px;
    opacity:0;
    pointer-events:none;
    filter: drop-shadow(0 18px 60px rgba(0,0,0,.45));
  }
  .rune::before{
    content:"";
    position:absolute; inset:0;
    border-radius:999px;
    background:
      radial-gradient(circle at 50% 50%, rgba(246,210,122,.22), transparent 56%),
      conic-gradient(from 0deg,
        rgba(246,210,122,.0),
        rgba(246,210,122,.55),
        rgba(246,210,122,.0),
        rgba(246,210,122,.45),
        rgba(246,210,122,.0)
      );
    mask: radial-gradient(circle at 50% 50%, transparent 57%, black 58%, black 64%, transparent 65%);
  }
  .rune svg{ position:absolute; inset:0; width:100%; height:100%; }
  .rune.on{
    opacity:1;
    animation: runePulse 1.7s ease-in-out infinite;
  }
  .rune.spin{
    animation: runeSpin 6s linear infinite;
  }
  @keyframes runeSpin{
    from { transform: translate(-50%,-50%) rotate(0deg); }
    to   { transform: translate(-50%,-50%) rotate(360deg); }
  }
  @keyframes runePulse{
    0%   { filter: drop-shadow(0 10px 35px rgba(246,210,122,.16)); }
    50%  { filter: drop-shadow(0 18px 70px rgba(246,210,122,.26)); }
    100% { filter: drop-shadow(0 10px 35px rgba(246,210,122,.16)); }
  }

  /* Golden burst when result appears */
  .burst{
    position:absolute;
    left:50%;
    top:43%;
    transform: translate(-50%,-50%);
    width:min(420px, 95vw);
    aspect-ratio: 1/1;
    border-radius:999px;
    pointer-events:none;
    opacity:0;
    background:
      radial-gradient(circle at 50% 50%, rgba(246,210,122,.22), transparent 58%),
      radial-gradient(circle at 50% 50%, rgba(246,210,122,.10), transparent 72%);
    filter: blur(0.2px) drop-shadow(0 25px 80px rgba(246,210,122,.28));
  }
  .burst.show{
    animation: burstPop 780ms cubic-bezier(.2,.9,.2,1) both;
  }
  @keyframes burstPop{
    0%{ opacity:0; transform: translate(-50%,-50%) scale(.92); }
    45%{ opacity:1; transform: translate(-50%,-50%) scale(1.02); }
    100%{ opacity:0; transform: translate(-50%,-50%) scale(1.08); }
  }

  /* Cups */
  .cups{
    display:flex;
    justify-content:center;
    align-items:flex-end;
    gap: 34px;
    margin: 6px 0 18px;
    position:relative;
  }
  .cup{
    width: min(140px, 34vw);
    height: min(140px, 34vw);
    filter: drop-shadow(0 18px 40px rgba(0,0,0,.55));
    transform-origin: 50% 80%;
    animation: floaty 4.4s ease-in-out infinite;
  }
  .cup:nth-child(2){ animation-delay: -1.8s; }
  @keyframes floaty{
    0%{ transform: translateY(0px); }
    50%{ transform: translateY(-6px); }
    100%{ transform: translateY(0px); }
  }
  .cup img{
    width:100%;
    height:100%;
    object-fit:contain;
    user-select:none;
    -webkit-user-drag:none;
  }

  /* Throw animation */
  .throw{
    animation: toss 1.05s cubic-bezier(.18,.8,.22,1) both !important;
  }
  @keyframes toss{
    0%   { transform: translateY(0) rotate(0deg) scale(1); }
    18%  { transform: translateY(-18px) rotate(35deg) scale(1.02); }
    45%  { transform: translateY(-78px) rotate(240deg) scale(1.05); }
    72%  { transform: translateY(10px) rotate(360deg) scale(1.0); }
    84%  { transform: translateY(-6px) rotate(360deg) scale(1.0); }
    100% { transform: translateY(0) rotate(360deg) scale(1); }
  }

  /* Result text */
  .result{
    margin: 6px 0 2px;
    font-size: 22px;
    font-weight: 700;
    letter-spacing:.10em;
    text-shadow: 0 0 18px rgba(246,210,122,.22);
    min-height: 30px;
  }
  .result-en{
    margin: 0 0 18px;
    font-size: 13px;
    color: var(--muted);
    letter-spacing:.06em;
    min-height: 18px;
  }

  /* Button */
  .btn{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    gap:10px;
    padding: 14px 42px;
    border-radius: 999px;
    border: 1px solid rgba(246,210,122,.35);
    background: linear-gradient(45deg, rgba(217,169,75,.92), rgba(246,210,122,.92));
    color: rgba(10,10,14,.95);
    font-weight: 800;
    letter-spacing:.12em;
    box-shadow: var(--shadow);
    cursor:pointer;
    user-select:none;
    -webkit-tap-highlight-color: transparent;
    transition: transform .12s ease, filter .12s ease;
  }
  .btn:active{ transform: scale(.98); filter: brightness(.98); }

  /* Small footer */
  .foot{
    margin-top: 16px;
    font-size: 11px;
    color: rgba(255,255,255,.52);
    letter-spacing:.06em;
  }

  /* Small screens */
  @media (max-height: 680px){
    .subtitle{ margin-bottom: 18px; }
    .cups{ margin-top: 0; }
  }
</style>
</head>

<body>
<div class="bg" id="bg"></div>
<div class="shade"></div>
<div class="mist"></div>

<div class="wrap">
  <div class="stage">

    <h1 class="title">擲筊儀式體驗</h1>
    <p class="subtitle">Jiaobei Divination Experience</p>

    <div class="rune" id="rune" aria-hidden="true">
      <svg viewBox="0 0 100 100">
        <defs>
          <path id="circlePath" d="M50,50 m-34,0 a34,34 0 1,1 68,0 a34,34 0 1,1 -68,0" />
        </defs>
        <text fill="rgba(246,210,122,.92)" font-size="5.6" letter-spacing="1.6">
          <textPath href="#circlePath" startOffset="0%">
            ✶ 乾 ✦ 坤 ✶ 離 ✦ 坎 ✶ 震 ✦ 巽 ✶ 艮 ✦ 兌 ✶
          </textPath>
        </text>
      </svg>
    </div>

    <div class="burst" id="burst" aria-hidden="true"></div>

    <div class="cups" aria-label="Jiaobei blocks">
      <div class="cup" id="cup1"></div>
      <div class="cup" id="cup2"></div>
    </div>

    <div class="result" id="result">靜心 · 擲筊</div>
    <div class="result-en" id="resultEn">Center yourself and cast the blocks</div>

    <div class="btn" id="btn">擲筊 · CAST</div>

    <div class="foot">Interactive Ritual UI · Portfolio Edition</div>
  </div>
</div>

<script>
  // --- Elements ---
  const cup1 = document.getElementById("cup1");
  const cup2 = document.getElementById("cup2");
  const rune = document.getElementById("rune");
  const burst = document.getElementById("burst");
  const result = document.getElementById("result");
  const resultEn = document.getElementById("resultEn");
  const btn = document.getElementById("btn");
  const bg = document.getElementById("bg");

  // --- Render cups by images ---
  function render(aUp, bUp){
    cup1.innerHTML = `<img src="${aUp ? 'jiaobei_up.png' : 'jiaobei_down.png'}" alt="jiaobei">`;
    cup2.innerHTML = `<img src="${bUp ? 'jiaobei_up.png' : 'jiaobei_down.png'}" alt="jiaobei">`;
  }
  render(true, true);

  // --- Small parallax (subtle, premium) ---
  let px=0, py=0;
  window.addEventListener('pointermove', (e)=>{
    const x = (e.clientX / window.innerWidth) - 0.5;
    const y = (e.clientY / window.innerHeight) - 0.5;
    px = x; py = y;
  }, {passive:true});

  function raf(){
    // tiny movement to avoid nausea
    bg.style.transform = `scale(1.04) translate(${px*8}px, ${py*8}px)`;
    requestAnimationFrame(raf);
  }
  raf();

  // --- Audio: wood-like multi-hit (no external files) ---
  const audioCtx = (() => {
    try { return new (window.AudioContext || window.webkitAudioContext)(); }
    catch { return null; }
  })();

  function noiseBurst(atTime, dur){
    if(!audioCtx) return;
    const length = Math.floor(audioCtx.sampleRate * dur);
    const buffer = audioCtx.createBuffer(1, length, audioCtx.sampleRate);
    const data = buffer.getChannelData(0);
    for(let i=0;i<length;i++){
      data[i] = (Math.random()*2-1) * Math.exp(-i/(length/6));
    }
    const src = audioCtx.createBufferSource();
    src.buffer = buffer;

    const hp = audioCtx.createBiquadFilter();
    hp.type = 'highpass';
    hp.frequency.setValueAtTime(900, atTime);

    const g = audioCtx.createGain();
    g.gain.setValueAtTime(0.0001, atTime);
    g.gain.exponentialRampToValueAtTime(0.11, atTime + 0.006);
    g.gain.exponentialRampToValueAtTime(0.0001, atTime + dur);

    src.connect(hp); hp.connect(g); g.connect(audioCtx.destination);
    src.start(atTime);
    src.stop(atTime + dur + 0.02);
  }

  function woodTone(atTime, hz, decay){
    if(!audioCtx) return;
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    const bp = audioCtx.createBiquadFilter();

    o.type = 'triangle';
    o.frequency.setValueAtTime(hz, atTime);

    bp.type = 'bandpass';
    bp.frequency.setValueAtTime(hz * 1.25, atTime);
    bp.Q.setValueAtTime(7.5, atTime);

    g.gain.setValueAtTime(0.0001, atTime);
    g.gain.exponentialRampToValueAtTime(0.22, atTime + 0.008);
    g.gain.exponentialRampToValueAtTime(0.0001, atTime + decay);

    o.connect(bp); bp.connect(g); g.connect(audioCtx.destination);
    o.start(atTime);
    o.stop(atTime + decay + 0.02);
  }

  function playWoodLanding(){
    if(!audioCtx) return;
    const t = audioCtx.currentTime + 0.01;

    // 3 hits, like bouncing
    noiseBurst(t + 0.00, 0.060); woodTone(t + 0.00, 380, 0.12);
    noiseBurst(t + 0.10, 0.050); woodTone(t + 0.10, 320, 0.14);
    noiseBurst(t + 0.22, 0.045); woodTone(t + 0.22, 260, 0.16);
  }

  // --- Logic ---
  // 聖筊：一正一反；陰筊：兩反；笑筊：兩正
  function interpret(aUp, bUp){
    if(aUp && bUp) return { zh:"笑筊", en:"Ambiguous · The gods are smiling" };
    if(!aUp && !bUp) return { zh:"陰筊", en:"No · Not granted" };
    return { zh:"聖筊", en:"Yes · Permission granted" };
  }

  // --- Premium visual cues ---
  function runeOn(){
    rune.classList.add("on","spin");
  }
  function runeOff(){
    rune.classList.remove("on","spin");
  }
  function burstPop(){
    burst.classList.remove("show");
    void burst.offsetWidth;
    burst.classList.add("show");
  }

  let busy = false;

  function throwJiaobei(){
    if(busy) return;
    busy = true;

    // resume audio (iOS)
    if(audioCtx && audioCtx.state === "suspended"){
      audioCtx.resume().catch(()=>{});
    }

    // haptic
    if(navigator.vibrate) navigator.vibrate([18, 24, 18]);

    // start visuals
    runeOn();
    result.textContent = "擲筊中…";
    resultEn.textContent = "Casting…";

    // animate cups
    cup1.classList.remove("throw"); cup2.classList.remove("throw");
    void cup1.offsetWidth;
    cup1.classList.add("throw");
    cup2.classList.add("throw");

    // shuffle during throw (adds realism)
    const t0 = performance.now();
    const shake = setInterval(()=>{
      render(Math.random()<0.5, Math.random()<0.5);
      if(performance.now() - t0 > 640) clearInterval(shake);
    }, 90);

    // landing sound near landing moment
    setTimeout(()=> playWoodLanding(), 660);

    // final settle
    const aUp = Math.random() < 0.5;
    const bUp = Math.random() < 0.5;

    setTimeout(()=>{
      render(aUp, bUp);
      const r = interpret(aUp, bUp);

      burstPop();

      // Slightly different glow by result
      result.textContent = r.zh;
      resultEn.textContent = r.en;

      // keep rune a bit then fade
      setTimeout(()=> runeOff(), 1200);

      busy = false;
    }, 900);
  }

  btn.addEventListener("click", throwJiaobei);

  // Optional: tap anywhere to cast (nice on mobile)
  document.body.addEventListener("dblclick", (e)=>{
    e.preventDefault();
    throwJiaobei();
  }, {passive:false});
</script>
</body>
</html>
