<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="theme-color" content="#0b1020" />
<title>ç·šä¸Šæ“²ç­Šï½œå„€å¼æ„Ÿç‰ˆæœ¬</title>
<style>
  :root{
    --bg1:#070b16;
    --bg2:#111b3a;
    --gold:#f6d27a;
    --gold2:#d9a94b;
    --ink:#e9ecff;
    --muted:rgba(233,236,255,.72);
    --card:rgba(255,255,255,.06);
    --shadow:0 18px 50px rgba(0,0,0,.45);
  }

  *{box-sizing:border-box}
  body{
    margin:0;
    min-height:100svh;
    color:var(--ink);
    font-family: ui-sans-serif, system-ui, -apple-system, "Noto Sans TC", "PingFang TC", "Microsoft JhengHei", Arial, sans-serif;
    background:
      radial-gradient(1200px 600px at 50% -10%, rgba(246,210,122,.18), transparent 55%),
      radial-gradient(900px 700px at 15% 30%, rgba(120,160,255,.18), transparent 55%),
      radial-gradient(900px 700px at 85% 55%, rgba(255,120,210,.10), transparent 60%),
      linear-gradient(180deg, var(--bg1), var(--bg2));
    overflow-x:hidden;
  }

  /* â­ subtle particles */
  .stars{
    position:fixed; inset:0;
    pointer-events:none;
    opacity:.35;
    background-image:
      radial-gradient(2px 2px at 20px 30px, rgba(255,255,255,.55), transparent 60%),
      radial-gradient(1px 1px at 120px 80px, rgba(255,255,255,.35), transparent 60%),
      radial-gradient(1.5px 1.5px at 220px 140px, rgba(255,255,255,.4), transparent 60%),
      radial-gradient(1px 1px at 340px 60px, rgba(255,255,255,.3), transparent 60%),
      radial-gradient(2px 2px at 480px 160px, rgba(255,255,255,.4), transparent 60%);
    background-size: 560px 220px;
    animation: drift 18s linear infinite;
    filter: blur(.15px);
  }
  @keyframes drift{ from{transform:translateY(0)} to{transform:translateY(40px)} }

  /* ğŸ Horse watermark background (upload horse.jpg to repo root) */
  .horse-bg{
    position:fixed; inset:0;
    pointer-events:none;
    background-image: url("horse.jpg");
    background-repeat:no-repeat;
    background-position: 78% 18%;
    background-size: min(560px, 72vw);
    opacity: .10;
    filter: saturate(1.05) contrast(1.05) drop-shadow(0 30px 60px rgba(0,0,0,.45));
    transform: rotate(-6deg);
  }

  .wrap{
    width:min(980px, 92vw);
    margin:0 auto;
    padding: clamp(18px, 5vw, 36px) 0 56px;
    position:relative;
    z-index:1;
  }

  header{
    display:flex;
    align-items:flex-start;
    justify-content:space-between;
    gap:18px;
    margin: 10px 0 18px;
  }
  .brand{ display:flex; flex-direction:column; gap:8px; }
  .title{
    font-size: clamp(28px, 4.2vw, 42px);
    letter-spacing:.06em;
    margin:0;
    text-shadow: 0 10px 30px rgba(0,0,0,.5);
  }
  .subtitle{
    margin:0;
    color:var(--muted);
    line-height:1.6;
    max-width: 48ch;
  }
  .badge{
    align-self:flex-start;
    padding:10px 12px;
    border:1px solid rgba(246,210,122,.25);
    border-radius:14px;
    background: rgba(255,255,255,.05);
    box-shadow: var(--shadow);
    color: rgba(246,210,122,.92);
    font-size: 13px;
    letter-spacing:.06em;
    backdrop-filter: blur(10px);
  }

  .grid{
    display:grid;
    grid-template-columns: 1.2fr .8fr;
    gap:18px;
  }
  @media (max-width: 860px){ .grid{grid-template-columns: 1fr; } }

  .card{
    background: rgba(255,255,255,.06);
    border:1px solid rgba(255,255,255,.10);
    border-radius: 20px;
    box-shadow: var(--shadow);
    backdrop-filter: blur(14px);
  }
  .main{
    padding: 20px;
    position:relative;
    overflow:hidden;
  }
  .main:before{
    content:"";
    position:absolute; inset:-2px;
    background: radial-gradient(700px 240px at 50% 0%, rgba(246,210,122,.10), transparent 60%);
    pointer-events:none;
  }

  .ritual{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:14px;
    padding: 12px 12px 16px;
    border:1px solid rgba(246,210,122,.12);
    border-radius:16px;
    background: rgba(0,0,0,.16);
  }

  .qbox{ flex:1; }
  label{
    display:block;
    font-size: 13px;
    letter-spacing:.08em;
    color: rgba(246,210,122,.9);
    margin: 0 0 8px;
  }
  input{
    width:100%;
    padding: 12px 12px;
    border-radius: 14px;
    border:1px solid rgba(255,255,255,.14);
    background: rgba(10,12,24,.55);
    color: var(--ink);
    outline:none;
    font-size: 15px;
  }
  input::placeholder{ color: rgba(233,236,255,.45); }

  .controls{
    display:flex;
    flex-wrap:wrap;
    gap:10px;
    margin-top: 14px;
    align-items:center;
  }
  button{
    border:1px solid rgba(246,210,122,.35);
    background: linear-gradient(180deg, rgba(246,210,122,.22), rgba(246,210,122,.08));
    color: rgba(246,210,122,.95);
    padding: 12px 16px;
    border-radius: 14px;
    font-weight: 700;
    letter-spacing:.08em;
    cursor:pointer;
    transition: transform .12s ease, filter .12s ease;
    user-select:none;
  }
  button:hover{ transform: translateY(-1px); filter: brightness(1.08); }
  button:active{ transform: translateY(0px) scale(.99); filter: brightness(.98); }

  .toggle{
    display:flex; gap:10px; align-items:center;
    color: var(--muted);
    font-size: 14px;
    margin-left:auto;
  }
  .toggle input{ width:auto; accent-color: var(--gold); }

  .stage{
    margin-top: 16px;
    padding: 18px 14px 16px;
    border-radius: 18px;
    border: 1px solid rgba(255,255,255,.10);
    background: rgba(0,0,0,.22);
    position:relative;
    overflow:hidden;
  }
  .stage:after{
    content:"";
    position:absolute; left:0; right:0; bottom:-1px; height:42px;
    background: radial-gradient(140px 40px at 50% 100%, rgba(246,210,122,.22), transparent 70%);
    pointer-events:none;
  }

  .cup-row{
    display:flex;
    justify-content:center;
    gap: clamp(10px, 3vw, 18px);
    align-items:flex-end;
    padding: 10px 0 6px;
    min-height: 240px;
    position:relative;
  }

  /* âœ¨ Rune ring overlay */
  .runes{
    position:absolute;
    left:50%;
    top: 40%;
    transform: translate(-50%,-50%);
    width: min(360px, 86vw);
    aspect-ratio: 1/1;
    border-radius: 999px;
    pointer-events:none;
    opacity: 0;
    filter: drop-shadow(0 18px 50px rgba(0,0,0,.35));
  }
  .runes::before{
    content:"";
    position:absolute; inset:0;
    border-radius:999px;
    background:
      radial-gradient(circle at 50% 50%, rgba(246,210,122,.24), transparent 56%),
      conic-gradient(from 0deg,
        rgba(246,210,122,.0),
        rgba(246,210,122,.55),
        rgba(246,210,122,.0),
        rgba(246,210,122,.45),
        rgba(246,210,122,.0)
      );
    mask: radial-gradient(circle at 50% 50%, transparent 57%, black 58%, black 64%, transparent 65%);
  }
  .runes svg{ position:absolute; inset:0; width:100%; height:100%; }

  .runes.on{
    opacity: 1;
    animation: runePulse 1.6s ease-in-out infinite;
  }
  @keyframes runePulse{
    0%   { transform: translate(-50%,-50%) scale(.98); filter: drop-shadow(0 10px 35px rgba(246,210,122,.18)); }
    50%  { transform: translate(-50%,-50%) scale(1.02); filter: drop-shadow(0 16px 55px rgba(246,210,122,.26)); }
    100% { transform: translate(-50%,-50%) scale(.98); filter: drop-shadow(0 10px 35px rgba(246,210,122,.18)); }
  }
  .runes.spin{ animation: runeSpin 4.6s linear infinite; }
  @keyframes runeSpin{
    from { transform: translate(-50%,-50%) rotate(0deg); }
    to   { transform: translate(-50%,-50%) rotate(360deg); }
  }

  .cup{
    width: min(220px, 40vw);
    aspect-ratio: 1 / 1;
    filter: drop-shadow(0 20px 40px rgba(0,0,0,.45));
    transform-origin: 50% 80%;
  }
  .throwing{ animation: toss 1.05s cubic-bezier(.18,.8,.22,1) both; }
  @keyframes toss{
    0%   { transform: translateY(0) rotate(0deg) scale(1); }
    15%  { transform: translateY(-18px) rotate(30deg) scale(1.02); }
    40%  { transform: translateY(-70px) rotate(220deg) scale(1.05); }
    70%  { transform: translateY(8px) rotate(360deg) scale(1.0); }
    82%  { transform: translateY(-6px) rotate(360deg) scale(1.0); }
    100% { transform: translateY(0) rotate(360deg) scale(1); }
  }

  .result{
    text-align:center;
    margin: 10px 0 0;
    font-size: clamp(18px, 2.4vw, 22px);
    letter-spacing:.06em;
    color: rgba(233,236,255,.92);
  }
  .result strong{ color: var(--gold); }

  .chips{
    display:flex;
    flex-wrap:wrap;
    gap:8px;
    justify-content:center;
    margin-top: 10px;
  }
  .chip{
    font-size: 12px;
    padding: 7px 10px;
    border-radius: 999px;
    border:1px solid rgba(246,210,122,.22);
    background: rgba(255,255,255,.05);
    color: rgba(246,210,122,.9);
    letter-spacing:.06em;
  }

  .side{ padding: 16px; }
  .side h2{
    margin: 4px 0 10px;
    font-size: 16px;
    letter-spacing:.08em;
    color: rgba(246,210,122,.95);
  }
  .hint{
    margin: 0 0 14px;
    color: var(--muted);
    line-height:1.7;
    font-size: 14px;
  }
  .list{
    display:flex;
    flex-direction:column;
    gap:10px;
    max-height: 420px;
    overflow:auto;
    padding-right: 4px;
  }
  .item{
    border:1px solid rgba(255,255,255,.10);
    background: rgba(0,0,0,.18);
    border-radius: 14px;
    padding: 10px 12px;
  }
  .item .q{ color: rgba(233,236,255,.9); font-size: 13px; line-height:1.5; }
  .item .r{ margin-top:6px; color: rgba(246,210,122,.9); font-weight:700; letter-spacing:.05em; }
  .meta{
    display:flex;
    justify-content:space-between;
    gap:10px;
    margin-top:8px;
    color: rgba(233,236,255,.55);
    font-size: 12px;
  }
  .footer{
    margin-top: 16px;
    color: rgba(233,236,255,.45);
    font-size: 12px;
    text-align:center;
    letter-spacing:.04em;
  }

  .cup svg{ width:100%; height:100%; }
</style>
</head>

<body>
<div class="stars" aria-hidden="true"></div>
<div class="horse-bg" aria-hidden="true"></div>

<div class="wrap">
  <header>
    <div class="brand">
      <h1 class="title">ğŸ™ ç·šä¸Šæ“²ç­Š</h1>
      <p class="subtitle">éœå¿ƒã€èª å•ã€å†æ“²ã€‚å«æœ¨é ­è½åœ°éŸ³æ•ˆã€é‡‘è‰²ç¬¦æ–‡å…‰åœˆã€é¦¬ç´‹å„€å¼èƒŒæ™¯ã€‚</p>
    </div>
    <div class="badge">JIAOBEI â€¢ RITUAL EDITION</div>
  </header>

  <div class="grid">
    <section class="card main">
      <div class="ritual">
        <div class="qbox">
          <label for="question">ä½ çš„å•é¡Œï¼ˆå¯ç•™ç©ºï¼‰</label>
          <input id="question" placeholder="ä¾‹å¦‚ï¼šæˆ‘ä»Šå¤©è¦å»å—ï¼Ÿï¼é€™å€‹æ–¹æ¡ˆå¯è¡Œå—ï¼Ÿ" maxlength="80" />
          <div class="controls">
            <button id="btnThrow">æ“²ç­Š</button>
            <button id="btnClear" title="æ¸…ç©ºç´€éŒ„">æ¸…ç©º</button>

            <div class="toggle">
              <label style="margin:0; color: rgba(233,236,255,.7); letter-spacing:0;">éŸ³æ•ˆ</label>
              <input id="soundToggle" type="checkbox" checked />
            </div>
          </div>
        </div>
      </div>

      <div class="stage">
        <div class="cup-row" aria-label="æ“²ç­Šå‹•ç•«å€">
          <div class="runes" id="runes" aria-hidden="true">
            <!-- rune symbols ring -->
            <svg viewBox="0 0 100 100">
              <defs>
                <path id="circlePath" d="M50,50 m-34,0 a34,34 0 1,1 68,0 a34,34 0 1,1 -68,0" />
              </defs>
              <text fill="rgba(246,210,122,.92)" font-size="5.5" letter-spacing="1.4">
                <textPath href="#circlePath" startOffset="0%">
                  âœ¶ ä¹¾ âœ¦ å¤ âœ¶ é›¢ âœ¦ å âœ¶ éœ‡ âœ¦ å·½ âœ¶ è‰® âœ¦ å…Œ âœ¶
                </textPath>
              </text>
            </svg>
          </div>

          <div class="cup" id="cup1"></div>
          <div class="cup" id="cup2"></div>
        </div>

        <div class="result" id="result">æº–å‚™å¥½äº†å°±æŒ‰ <strong>æ“²ç­Š</strong></div>
        <div class="chips" id="chips"></div>
      </div>

      <div class="footer">è–ç­Šï¼ä¸€æ­£ä¸€åï¼›é™°ç­Šï¼å…©åï¼›ç¬‘ç­Šï¼å…©æ­£ï¼ˆè±¡å¾µæœªå®š/ä¸æ˜ï¼‰ã€‚</div>
    </section>

    <aside class="card side">
      <h2>ğŸ§¾ æ“²ç­Šç´€éŒ„</h2>
      <p class="hint">æ¯æ¬¡æ“²ç­Šæœƒè¨˜ä¸‹çµæœèˆ‡æ™‚é–“ã€‚ä½ ä¹Ÿå¯ä»¥è¼¸å…¥å•é¡Œï¼Œè®“ç´€éŒ„æ›´æ¸…æ¥šã€‚</p>
      <div class="list" id="history"></div>
      <div class="footer">åšæˆ GitHub Pages å¾Œï¼Œæƒ QR å°±èƒ½ç›´æ¥ä½¿ç”¨ã€‚</div>
    </aside>
  </div>
</div>

<script>
  // ---- Wood-like impact sound (no external files) ----
  const audioCtx = (() => {
    try { return new (window.AudioContext || window.webkitAudioContext)(); }
    catch { return null; }
  })();

  function woodHit(atTime, toneHz, decay){
    if(!audioCtx) return;
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    const f = audioCtx.createBiquadFilter();

    o.type = 'triangle';
    o.frequency.setValueAtTime(toneHz, atTime);

    // bandpass to make it "wooden"
    f.type = 'bandpass';
    f.frequency.setValueAtTime(toneHz * 1.2, atTime);
    f.Q.setValueAtTime(7, atTime);

    g.gain.setValueAtTime(0.0001, atTime);
    g.gain.exponentialRampToValueAtTime(0.22, atTime + 0.008);
    g.gain.exponentialRampToValueAtTime(0.0001, atTime + decay);

    o.connect(f);
    f.connect(g);
    g.connect(audioCtx.destination);

    o.start(atTime);
    o.stop(atTime + decay + 0.02);
  }

  function knockNoise(atTime, dur){
    if(!audioCtx) return;
    const bufferSize = audioCtx.sampleRate * dur;
    const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
    const data = buffer.getChannelData(0);
    for(let i=0;i<bufferSize;i++){
      // short, sharp noise burst
      data[i] = (Math.random()*2-1) * Math.exp(-i/(bufferSize/6));
    }
    const src = audioCtx.createBufferSource();
    src.buffer = buffer;

    const hp = audioCtx.createBiquadFilter();
    hp.type = 'highpass';
    hp.frequency.setValueAtTime(900, atTime);

    const g = audioCtx.createGain();
    g.gain.setValueAtTime(0.0001, atTime);
    g.gain.exponentialRampToValueAtTime(0.12, atTime + 0.006);
    g.gain.exponentialRampToValueAtTime(0.0001, atTime + dur);

    src.connect(hp); hp.connect(g); g.connect(audioCtx.destination);
    src.start(atTime);
    src.stop(atTime + dur + 0.02);
  }

  function playWoodDrops(){
    const on = document.getElementById('soundToggle').checked;
    if(!on || !audioCtx) return;

    // iOS needs user gesture; button click already provides it
    const t = audioCtx.currentTime + 0.01;

    // 3 little impacts = like two cups bouncing
    knockNoise(t + 0.00, 0.06);
    woodHit(t + 0.00, 380, 0.12);

    knockNoise(t + 0.10, 0.05);
    woodHit(t + 0.10, 320, 0.14);

    knockNoise(t + 0.22, 0.045);
    woodHit(t + 0.22, 260, 0.16);
  }

  // --- SVG â€œæ¯ç­Šâ€ (one piece) ---
  function cupSVG(faceUp=true){
    const top = faceUp ? '#f7d78c' : '#b77a1f';
    const mid = faceUp ? '#e0a83d' : '#7f4f10';
    const glow = faceUp ? 'rgba(246,210,122,.28)' : 'rgba(0,0,0,.0)';

    return `
    <svg viewBox="0 0 240 240" role="img" aria-label="ç­Šæ¯">
      <defs>
        <radialGradient id="g1" cx="40%" cy="30%" r="70%">
          <stop offset="0%" stop-color="${top}"/>
          <stop offset="55%" stop-color="${mid}"/>
          <stop offset="100%" stop-color="#3a2410"/>
        </radialGradient>
        <filter id="soft" x="-20%" y="-20%" width="140%" height="140%">
          <feGaussianBlur stdDeviation="1.6" result="b"/>
          <feMerge>
            <feMergeNode in="b"/>
            <feMergeNode in="SourceGraphic"/>
          </feMerge>
        </filter>
      </defs>

      <ellipse cx="120" cy="170" rx="74" ry="28" fill="${glow}" filter="url(#soft)"/>

      <path d="M55 150
               C70 85, 170 85, 185 150
               C168 172, 145 186, 120 186
               C95 186, 72 172, 55 150Z"
            fill="url(#g1)"
            stroke="rgba(246,210,122,.25)"
            stroke-width="2.2" />

      <path d="M78 144
               C90 105, 150 105, 162 144
               C148 158, 136 166, 120 166
               C104 166, 92 158, 78 144Z"
            fill="rgba(255,255,255,.10)" />

      <path d="M60 150 C78 92, 162 92, 180 150"
            fill="none"
            stroke="rgba(255,255,255,.18)"
            stroke-width="3"
            stroke-linecap="round"/>

      <ellipse cx="120" cy="186" rx="56" ry="14" fill="rgba(0,0,0,.22)"/>
    </svg>`;
  }

  const cup1 = document.getElementById('cup1');
  const cup2 = document.getElementById('cup2');
  const runes = document.getElementById('runes');
  const resultEl = document.getElementById('result');
  const chipsEl = document.getElementById('chips');
  const historyEl = document.getElementById('history');
  const qEl = document.getElementById('question');

  function renderCups(aUp=true, bUp=true){
    cup1.innerHTML = cupSVG(aUp);
    cup2.innerHTML = cupSVG(bUp);
  }
  renderCups(true,true);

  function nowStr(){
    const d = new Date();
    const pad = n => String(n).padStart(2,'0');
    return `${pad(d.getMonth()+1)}/${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`;
  }

  function interpret(aUp, bUp){
    if(aUp && bUp) return {key:"ç¬‘ç­Š", text:"ğŸ˜„ ç¬‘ç­Š", desc:"è±¡å¾µæœªå®šï¼ç¥æ˜å¾®ç¬‘"};
    if(!aUp && !bUp) return {key:"é™°ç­Š", text:"ğŸŒ™ é™°ç­Š", desc:"ä¸å…ï¼å¦"};
    return {key:"è–ç­Š", text:"âœ¨ è–ç­Š", desc:"å…è¨±ï¼æ˜¯"};
  }

  const chipsMap = {
    "è–ç­Š": ["å¯è¡Œ", "é †å‹¢", "å¯ä»¥å‰é€²"],
    "é™°ç­Š": ["æš«ç·©", "å†æƒ³æƒ³", "æ­¤è·¯ä¸é€š"],
    "ç¬‘ç­Š": ["æœªå®š", "å†å•ä¸€æ¬¡", "å¿ƒæœªèª æˆ–æ™‚æ©Ÿæœªåˆ°"]
  };

  function setChips(key){
    chipsEl.innerHTML = "";
    for(const c of chipsMap[key] || []){
      const span = document.createElement('span');
      span.className = 'chip';
      span.textContent = c;
      chipsEl.appendChild(span);
    }
  }

  function addHistory(question, info){
    const div = document.createElement('div');
    div.className = 'item';
    div.innerHTML = `
      <div class="q">${question ? "Qï¼š"+escapeHtml(question) : "Qï¼šï¼ˆæœªå¡«ï¼‰"}</div>
      <div class="r">${info.text} <span style="font-weight:600;color:rgba(233,236,255,.75)">â€” ${info.desc}</span></div>
      <div class="meta"><span>${nowStr()}</span><span>${info.key}</span></div>
    `;
    historyEl.prepend(div);
  }

  function escapeHtml(s){
    return s.replace(/[&<>"']/g, (c) => ({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
    }[c]));
  }

  function runeOn(){
    runes.classList.add('on','spin');
  }
  function runeOff(){
    runes.classList.remove('on','spin');
  }

  function throwJiaobei(){
    // Animate throw
    cup1.classList.remove('throwing'); cup2.classList.remove('throwing');
    void cup1.offsetWidth;
    cup1.classList.add('throwing');
    cup2.classList.add('throwing');

    // Rune appears during throw
    runeOn();

    // shuffle faces while throwing
    const t0 = performance.now();
    const shake = setInterval(() => {
      renderCups(Math.random()<0.5, Math.random()<0.5);
      if(performance.now() - t0 > 650) clearInterval(shake);
    }, 90);

    // Play wood drops near landing moment
    setTimeout(() => playWoodDrops(), 640);

    // settle result
    const aUp = Math.random() < 0.5;
    const bUp = Math.random() < 0.5;

    setTimeout(() => {
      renderCups(aUp, bUp);
      const info = interpret(aUp, bUp);

      resultEl.innerHTML = `çµæœï¼š<strong>${info.text}</strong>ã€€<span style="color:rgba(233,236,255,.78)">(${info.desc})</span>`;
      setChips(info.key);
      addHistory(qEl.value.trim(), info);

      // keep rune a bit then fade
      setTimeout(() => runeOff(), 1400);
    }, 850);
  }

  document.getElementById('btnThrow').addEventListener('click', throwJiaobei);

  document.getElementById('btnClear').addEventListener('click', () => {
    historyEl.innerHTML = "";
    qEl.value = "";
    resultEl.innerHTML = `æº–å‚™å¥½äº†å°±æŒ‰ <strong>æ“²ç­Š</strong>`;
    chipsEl.innerHTML = "";
    renderCups(true,true);
    runeOff();
  });
</script>
</body>
</html>
